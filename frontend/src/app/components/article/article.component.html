<div *ngIf="article" class="article-container">
  <h1>{{ article.title }}</h1>
  <div class="article-meta">
    <span>by {{ article.authorName }} on {{ article.postedDate | date }}</span>
  </div>
  <p>{{ article.content }}</p>
  <div class="article-actions">
    <button class="like-button" (click)="likeArticle()" [class.liked]="article?.userHasLiked">
      {{ article?.userHasLiked ? 'Unlike' : 'Like' }} ({{ article?.likes || 0 }})
    </button>
    <button class="share-button" (click)="toggleSharePopup()">
      <i class="fas fa-share"></i> Share
    </button>
  </div>
  
  <!-- Share Popup -->
  <div class="share-popup" *ngIf="showSharePopup" (click)="toggleSharePopup()">
    <div class="share-popup-content" (click)="$event.stopPropagation()">
      <div class="share-popup-header">
        <h3>Share this article</h3>
        <button class="close-button" (click)="toggleSharePopup()">Ã—</button>
      </div>
      <div class="share-options">
        <div class="share-option-wrapper">
          <button class="share-option-circle facebook" disabled>
            <i class="fab fa-facebook-f"></i>
          </button>
          <span class="option-label">Facebook</span>
        </div>
        <div class="share-option-wrapper">
          <button class="share-option-circle instagram" disabled>
            <i class="fab fa-instagram"></i>
          </button>
          <span class="option-label">Instagram</span>
        </div>
        <div class="share-option-wrapper">
          <button class="share-option-circle twitter" disabled>
            <i class="fab fa-x-twitter"></i>
          </button>
          <span class="option-label">X</span>
        </div>
        <div class="share-option-wrapper">
          <button class="share-option-circle link" (click)="copyLinkToClipboard()">
            <i class="fas fa-link"></i>
            <span class="copy-feedback" *ngIf="linkCopied">Copied!</span>
          </button>
          <span class="option-label">Copy Link</span>
        </div>
      </div>
    </div>
  </div>

  <div class="comments-section">
    <h3>Comments ({{ comments.length }})</h3>
    
    <div *ngIf="comments.length === 0" class="no-comments">
      <p>No comments yet. Be the first to share your thoughts!</p>
    </div>
    
  <!-- Parent comment template - recursively handles displaying comments and their children -->
  <ng-template #commentTemplate let-comment>
    <div class="comment" [class.has-children]="comment.children && comment.children.length > 0">
      <div class="comment-avatar" aria-hidden="true">
        {{ (comment.userId || 0) % 100 | number:'2.0' }}
      </div>
      <div class="comment-body">
        <div class="comment-header">
          <span class="commenter">{{ comment.authorName }}</span>
          <span class="comment-date">{{ comment.createdAt | date:'medium' }}</span>
        </div>
        <div class="comment-bubble">
          <p class="comment-content">{{ comment.content }}</p>
          <button class="reply-button" (click)="startReply(comment.id)">Reply</button>
        </div>
        
        <!-- Reply form for this comment -->
        <div *ngIf="replyingToComment === comment.id" class="reply-form">
          <textarea 
            [(ngModel)]="replyText" 
            placeholder="Write your reply..."
            [disabled]="isLoading"
          ></textarea>
          <div class="reply-actions">
            <button class="cancel-reply" (click)="cancelReply()">Cancel</button>
            <button 
              class="submit-reply" 
              [disabled]="!replyText.trim() || isLoading" 
              (click)="submitReply(comment)"
            >
              {{ isLoading ? 'Submitting...' : 'Submit Reply' }}
            </button>
          </div>
        </div>
        
        <!-- Display child comments if any -->
        <div *ngIf="comment.children && comment.children.length > 0" class="child-comments">
          <div *ngFor="let childComment of comment.children" class="child-comment">
            <ng-container [ngTemplateOutlet]="commentTemplate" [ngTemplateOutletContext]="{$implicit: childComment}"></ng-container>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
  
  <!-- Root comments -->
  <div *ngFor="let comment of comments" class="comment-thread">
    <ng-container [ngTemplateOutlet]="commentTemplate" [ngTemplateOutletContext]="{$implicit: comment}"></ng-container>
  </div>
    
    <div class="add-comment">
      <h4>Add a comment</h4>
      <div *ngIf="commentError" class="comment-error">{{ commentError }}</div>
      <textarea 
        [(ngModel)]="newComment" 
        (ngModelChange)="onCommentInput($event)"
        placeholder="Share your thoughts..."
      ></textarea>
      <button 
        type="button"
        (click)="addComment()"
        [class.is-loading]="isLoading"
        class="comment-button"
      >
        {{ isLoading ? 'Posting...' : 'Post Comment' }}
      </button>
    </div>
  </div>
</div>

<div *ngIf="!article" class="loading">
  <p>Loading article...</p>
</div>